__author__ = 'Mariam'

# -*- coding: utf-8 -*-
import numpy as np
import copy
import pandas as pd
from sklearn import preprocessing
import matplotlib.pyplot as plt

#Column morphology for different species: human/rats/mice


class Column:
    def __init__(self,type=1):
        #Type: 0 for human, 1 for rats, 2 for mice
        Type=str(type)
        self.Len = {  # Column length on um [Defelipe et al. 2002] doi:10.1023/A:1024130211265
            '0': 2622.,  # human
            '1': 1827.,  # rat
            '2': 1210.,  # mouse
        }
        #Thickness of each layer in um [Defelipe et al. 2002] doi:10.1023/A:1024130211265
        self.L1_d={
            '0':235.,
            '1':123.,
            '2':69.,
        }


        self.L23_d={
            '0':295.+405.+370.,
            '1':457.,
            '2':235.,
        }

        self.L4_d={
            '0':285.,
            '1':152.,
            '2':208.,
        }

        self.L5_d={
            '0':552.,
            '1':321.+209.,
            '2':248.,
        }

        self.L6_d={
            '0':480.,
            '1':565.,
            '2':451.,
        }
        # density of neurons in the different layers in neurons/mm3 [[Defelipe et al. 2002] doi:10.1023/A:1024130211265]

        self.Dens1={
            '0': 8333,
            '1': 3472,
            '2': 18229,
        }

        self.Dens23={
            '0': 27205,
            '1': 61670,
            '2': 137645,
        }

        self.Dens4={
            '0': 46167,
            '1': 90965,
            '2': 181362,
        }

        self.Dens5={
            '0':  23076,
            '1': 40202,
            '2': 77765,
        }

        self.Dens6={
            '0':  16774,
            '1': 64286,
            '2': 122092,
        }



        self.Syn_NB={
            '0': 29807,
            '1':18018,
            '2':21133,
        }
        # column radius in um
        self.R={
            '0':300.,
            '1':210.,
            '2':210.,
        }
        self.Curvature = 2000
        #column length
        self.L=self.Len[Type]
        #Column diameter
        self.D=2*self.R[Type]
        #thickness of each layer of the column
        self.L_th=np.array([self.L1_d[Type], self.L23_d[Type], self.L4_d[Type], self.L5_d[Type], self.L6_d[Type]])
        #Number of synapses per cell for each column
        self.NB_Syn =self.Syn_NB[Type]
        #cell density in each layer
        self.Celldens=np.array([self.Dens1[Type], self.Dens23[Type], self.Dens4[Type], self.Dens5[Type], self.Dens6[Type]])*1e-9 #in neurons/um3
        #xortical column volume
        self.Volume=self.L_th*np.pi*self.R[Type]*self.R[Type]
        #cell number in each layer
        self.Layer_nbCells=self.Celldens* self.L_th*np.pi*self.R[Type]*self.R[Type]
        ##reduced numbers for simulation
        self.Layer_nbCells=self.Layer_nbCells/10
        #from Markram et al. 2015 rat model
        self.PYRpercent = np.array([0, 0.7, 0.9, 0.8, 0.9])
        self.INpercent = 1 - self.PYRpercent
        self.PVpercent = np.array([0, 0.3, 0.55, 0.45, 0.45])
        self.SSTpercent = np.array([0, 0.2, 0.25, 0.40, 0.35])
        self.VIPpercent = np.array([0, 0.40, 0.20, 0.15, 0.20])
        self.RLNpercent = np.array([1, 0.1, 0, 0, 0])
        self.GetCelltypes()
        # self.Layer_nbCells = np.array([322,7524, 4656, 6114,
        #                           12651]) / d  # markram et al. 2015total number of cells/neocortical column for each layer (L1-L2/3-L4-L5-L6)



        self.List_Lambda_s= np.array(
            [[0.032, 0, 0, -0.032, 0],  # layer II/III-> TPC,UPC,IPC,BPC,SSC
             [0.048, 0.048, 0, 0, -0.012],  # layer IV-> TPC,UPC,IPC,BPC,SSC
             [0.137, 0.048, 0, 0, 0],  # layer V-> TPC,UPC,IPC,BPC,SSC
             [0.117, 0, -0.104,0.024, 0]  # layer VI-> TPC,UPC,IPC,BPC,SSC
             ], dtype=float)

        self.List_Lambda_d= np.array(
            [[-0.120, 0, 0,0.120, 0],  # layer II/III-> TPC,UPC,IPC,BPC,SSC
             [-0.095, -0.095, 0, 0, 0],  # layer IV-> TPC,UPC,IPC,BPC,SSC
             [-0.071, -0.076, 0, 0, 0],  # layer V-> TPC,UPC,IPC,BPC,SSC
             [-0.046, 0, 0.047,0.019, 0]  # layer VI-> TPC,UPC,IPC,BPC,SSC
             ], dtype=float)

        self.List_Lambda_PV  = np.array([ 0.09,  0, 0, -0.07])
        self.List_Lambda_SST = np.array([-0.08,-0.07, -0.08,-0.06])
        self.List_Lambda_VIP = np.array([+0.2 , -0.025, -0.085, -0.1])
        self.List_Lambda_RLN = np.array([ 0   , 0,0,0])


        ###########Lambda  (f) Gabriel's values ############################
        self.List_Lambda_freqs=np.array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,52,54,56,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,122,124,126,128,130,132,134,136,138,140])
        self.List_Lambda_TPC23_s =np.array([0.09584646,0.09472341,0.0924551,0.09010995,0.08878615,0.08845376,0.08856755,0.08874163,0.08881397,0.08873451,0.08850708,0.08816672,0.08770559,0.08716909,0.08655107,0.08588158,0.085157,0.08438473,0.0836015,0.08279871,0.08195579,0.08111051,0.08025687,0.079393,0.0785274,0.07768973,0.07681076,0.07595144,0.07511298,0.07424906,0.07342203,0.07255274,0.0717751,0.07092457,0.07015455,0.06936465,0.06854074,0.0677881,0.06701984,0.06632828,0.06553813,0.06486885,0.06418288,0.06348046,0.06280002,0.06204675,0.06139217,0.06074347,0.06017048,0.05952012,0.05882937,0.05764205,0.05650957,0.0554195,0.05441263,0.05336317,0.05237128,0.05139188,0.05046394,0.0494465,0.04858321,0.0476549,0.04701491,0.04609711,0.04531552,0.04472108,0.04386901,0.04334533,0.04271179,0.04207385,0.04118052,0.04087006,0.04014375,0.03957892,0.03899214,0.03864546,0.03814053,0.03744795,0.03707194,0.036646,0.03622369,0.03578749,0.03532237,0.0348494,0.0342981,0.03400806,0.033674,0.03280131,0.03280555,0.03259726,0.03191462,0.03167764,0.03134432,0.030957,0.03090928,0.03009951])
        # self.List_Lambda_TPC23_d = np.array([0.06832323,0.06847225,0.06870485,0.06876454,0.06873748,0.06878332,0.06880562,0.06876423,0.06864794,0.06845853,0.06820191,0.06788334,0.06750996,0.06708861,0.06662535,0.06612556,0.06559497,0.06503996,0.06446311,0.06386965,0.06326405,0.06264486,0.06202046,0.06139135,0.06075799,0.060127,0.05949224,0.05885892,0.05823276,0.0576068,0.05698852,0.05637267,0.05576993,0.0551719,0.05457626,0.05399349,0.05341348,0.05283943,0.05228701,0.05174422,0.05119211,0.05067434,0.0501516,0.04964503,0.0491388,0.0486275,0.04814761,0.0476634,0.04720765,0.04674271,0.04627991,0.04540831,0.04456112,0.04373683,0.04295679,0.04219348,0.04145765,0.04075113,0.04005367,0.03940694,0.03875893,0.03814859,0.0375465,0.03696885,0.03640699,0.0358669,0.03534117,0.03484245,0.03434463,0.03387425,0.03339119,0.03296697,0.03250957,0.03208618,0.03166976,0.03127653,0.03090966,0.03051027,0.03014677,0.02979431,0.02944623,0.02910786,0.02876824,0.02843996,0.02812021,0.02781495,0.02752405,0.02721563,0.02694485,0.02664286,0.02637391,0.02611241,0.0258451,0.02559718,0.02533515,0.02509967])
        self.List_Lambda_TPC23_d = np.array([4.65764187e-03,3.26764160e-03,1.11113583e-03,-1.37225095e-03
,-2.79934679e-03,-3.13763937e-03,-2.94868118e-03,-2.59033747e-03
,-2.22560467e-03,-1.91179234e-03,-1.65631465e-03,-1.45246028e-03
,-1.29040666e-03,-1.15968743e-03,-1.05186552e-03,-9.60816370e-04
,-8.81550518e-04,-8.10219064e-04,-7.44313771e-04,-6.81911149e-04
,-6.21530985e-04,-5.62504341e-04,-5.04327665e-04,-4.46757235e-04
,-3.89744451e-04,-3.33220930e-04,-2.77601959e-04,-2.22516031e-04
,-1.68194750e-04,-1.14674450e-04,-6.19787867e-05,-1.01718135e-05
,4.07033658e-05,9.06377199e-05,1.39600594e-04,1.87529848e-04
,2.34525437e-04,2.80486035e-04,3.25425626e-04,3.69346554e-04
,4.12255350e-04,4.54143059e-04,4.95008970e-04,5.34862169e-04
,5.73699165e-04,6.11514721e-04,6.48315328e-04,6.84103546e-04
,7.18876626e-04,7.52641309e-04,7.85406441e-04,8.47954999e-04
,9.06602063e-04,9.61446928e-04,1.01262218e-03,1.06026950e-03
,1.10454992e-03,1.14563313e-03,1.18368771e-03,1.21954845e-03
,1.25141001e-03,1.28141654e-03,1.30907297e-03,1.33453462e-03
,1.35795351e-03,1.37946891e-03,1.39921708e-03,1.41732435e-03
,1.43390812e-03,1.44908187e-03,1.46294746e-03,1.47560369e-03
,1.48714066e-03,1.49764188e-03,1.50718729e-03,1.51740353e-03
,1.52369022e-03,1.53077820e-03,1.53716770e-03,1.54291363e-03
,1.54806315e-03,1.55266334e-03,1.55675571e-03,1.56037859e-03
,1.56356936e-03,1.56635916e-03,1.56878009e-03,1.57085969e-03
,1.57262338e-03,1.57409665e-03,1.57529992e-03,1.57625522e-03
,1.57698102e-03,1.57749448e-03,1.57781318e-03,1.57795044e-03])
        self.List_Lambda_UPC23_s = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_UPC23_d = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_IPC23_s = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_IPC23_d = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_BPC23_s = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_BPC23_d = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_SSC23_s = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_SSC23_d = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_TPC4_s = np.array([0.10685976,0.10431592,0.09738614,0.08685358,0.07591645,0.06706035,0.06078512,0.05650326,0.05347879,0.05117327,0.04926444,0.04756322,0.04598466,0.04448186,0.04302597,0.04162098,0.0402567,0.03892805,0.03765419,0.03642131,0.03523128,0.03407972,0.03297743,0.03191984,0.03090046,0.0299322,0.02899221,0.02808093,0.02724287,0.02641306,0.02561766,0.02485888,0.02414488,0.02344624,0.02276717,0.02212585,0.02151528,0.02092506,0.0203416,0.0198019,0.01925852,0.0187553,0.01826305,0.01779635,0.01734176,0.01689748,0.01647204,0.01606719,0.01569513,0.01530669,0.01494075,0.01423981,0.01358169,0.01294765,0.012402,0.01185517,0.01133044,0.01084984,0.01037921,0.0099815,0.00954581,0.00917959,0.00881275,0.00843599,0.0081073,0.00781253,0.00752894,0.00723435,0.00694481,0.00668245,0.00644009,0.00619809,0.00595689,0.00574601,0.00553794,0.00535057,0.00515132,0.00493818,0.00477384,0.00460805,0.00442599,0.00426759,0.00410025,0.00395722,0.00381826,0.00367258,0.00355946,0.00342958,0.00326205,0.003172,0.00305971,0.00293671,0.00283331,0.0027165,0.00263689,0.00251195])
        # self.List_Lambda_TPC4_d =-np.array([0.1445841,0.14806072,0.15419129,0.15990933,0.16340591,0.16456299,0.16392556,0.16202035,0.15923512,0.15585368,0.15208982,0.1480991,0.14399998,0.13987818,0.13579376,0.13179235,0.12790425,0.12414685,0.12053153,0.11706448,0.11374907,0.11057941,0.10755646,0.10467395,0.10192703,0.099309,0.09681478,0.09443519,0.09217023,0.09000686,0.08794095,0.08596876,0.08408667,0.08228074,0.08055732,0.07890575,0.07732148,0.07580136,0.07434361,0.07294582,0.07159933,0.07030858,0.0690619,0.0678616,0.06670548,0.0655933,0.06451275,0.06348162,0.0624752,0.06150845,0.06057013,0.05879014,0.05712269,0.05557063,0.05409696,0.05271822,0.05141691,0.05017686,0.04900274,0.04788274,0.04682903,0.04582457,0.04485918,0.04395185,0.04307002,0.04222553,0.04142869,0.04066525,0.03992456,0.03921261,0.03854353,0.037876,0.03725982,0.03665005,0.03606263,0.03546567,0.03495213,0.0344356,0.03390943,0.03340963,0.03293749,0.03247697,0.0320317,0.03161439,0.03119592,0.03080464,0.03043106,0.03001053,0.02961839,0.02930869,0.02895384,0.02860861,0.02825701,0.02792085,0.02764223,0.02730491])
        self.List_Lambda_TPC4_d = -np.array([0.0713773,0.06711055,0.05886315,0.04642169,0.03489836,0.026484
,0.02107933,0.01783231,0.01590043,0.01471043,0.01395286,0.0134429
,0.0130739,0.01279416,0.01257149,0.01238478,0.0122257,0.01208843
,0.01196706,0.01185944,0.0117642,0.01167893,0.01160253,0.01153455
,0.01147361,0.01141866,0.01136938,0.01132498,0.01128465,0.01124811
,0.0112149,0.01118437,0.01115622,0.01113023,0.01110596,0.01108316
,0.01106171,0.01104132,0.0110218,0.01100306,0.01098499,0.01096744
,0.01095035,0.01093366,0.01091727,0.0109011,0.01088511,0.01086923
,0.01085339,0.0108376,0.01082184,0.01079069,0.01076148,0.01073407
,0.0107064,0.01067764,0.01064755,0.01061606,0.01058317,0.01054893
,0.0105134,0.01047668,0.01043887,0.01040007,0.0103604,0.01031999
,0.010279,0.01023766,0.01019624,0.01015467,0.01011281,0.01007062
,0.0100281,0.00998532,0.0099423,0.00989911,0.00985578,0.00981236
,0.00976888,0.00972537,0.00968188,0.00963842,0.00959502,0.00955172
,0.00950852,0.00946545,0.00942253,0.00937977,0.0093372,0.00929483
,0.00925267,0.00921073,0.00916903,0.00912757,0.00908638,0.00904545])
        self.List_Lambda_UPC4_s = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_UPC4_d = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_IPC4_s = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_IPC4_d = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_BPC4_s = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_BPC4_d = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_SSC4_s = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_SSC4_d = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_TPC5_s =np.array([0.25717356,0.25415461,0.24602837,0.23138828,0.21289197,0.19474049,0.17946173,0.16735848,0.1576357,0.14941686,0.14212499,0.1354402,0.12920853,0.1233726,0.11789799,0.11278303,0.10801065,0.10354627,0.09939917,0.09553669,0.09191449,0.08857213,0.08543542,0.08250932,0.07977337,0.0772309,0.07480407,0.07252418,0.07046457,0.06846726,0.06659704,0.06481531,0.06314245,0.06157715,0.06009823,0.05869779,0.05733416,0.05606882,0.05489351,0.05371931,0.05266889,0.05161767,0.0506496,0.04965594,0.04874662,0.04793878,0.0470791,0.04630896,0.04550171,0.0447883,0.04404254,0.04281237,0.0415807,0.04046414,0.03935209,0.03843477,0.03755329,0.03668807,0.03590682,0.03506606,0.03441212,0.03374845,0.03309999,0.03254292,0.03199244,0.03137559,0.03094613,0.03026851,0.029912,0.02944123,0.02904757,0.02873364,0.02820509,0.02787454,0.02753678,0.02727749,0.02694036,0.02649161,0.02626163,0.02600571,0.02574801,0.02546367,0.02518893,0.02487214,0.02452008,0.02441632,0.02410199,0.02377169,0.02376341,0.02348003,0.02312655,0.02307323,0.02279558,0.0226094,0.0224676,0.02220027])
        # self.List_Lambda_TPC5_d =np.array([0.20494837,0.20483536,0.20346647,0.19927388,0.19260236,0.18495349,0.17744808,0.17040729,0.16373575,0.15732917,0.15115517,0.1452155,0.1394945,0.13402871,0.12885668,0.12399091,0.11943494,0.11518325,0.11122381,0.10753679,0.10410503,0.1009122,0.09793656,0.09515964,0.09256446,0.0901421,0.08786405,0.08573055,0.08372465,0.08183783,0.08005717,0.0783817,0.07679453,0.07529246,0.07386429,0.07251174,0.07123044,0.07000423,0.06883683,0.06771951,0.0666567,0.06563448,0.06465907,0.06372262,0.06282034,0.06195674,0.06111951,0.06032225,0.05954663,0.05880296,0.05807936,0.05671125,0.05542995,0.05422677,0.05309188,0.05201528,0.05101135,0.05003758,0.04913334,0.04824375,0.04742015,0.04662454,0.0458571,0.04513259,0.04442962,0.04375543,0.04310241,0.04249361,0.04188072,0.04130113,0.04073946,0.04019233,0.03966922,0.039163,0.03865241,0.03818844,0.03774803,0.03727719,0.03684103,0.03642782,0.03601204,0.03561041,0.03521277,0.03482484,0.03444687,0.03408631,0.03373902,0.03335691,0.03304957,0.03272212,0.03237039,0.03208008,0.03176977,0.03145733,0.03118124,0.03085132])
        self.List_Lambda_TPC5_d = np.array([0.11454719,0.11065448,0.10407243,0.09125918,0.07555228,0.06063822
,0.04868038,0.04009531,0.03430775,0.03044942,0.02785772,0.02605793
,0.02468513,0.02356713,0.02261236,0.02176383,0.02099001,0.02027535
,0.01960811,0.01898058,0.01838894,0.01782975,0.01729983,0.01679728
,0.01632051,0.01586755,0.01543694,0.01502754,0.01463799,0.01426707
,0.01391387,0.01357742,0.01325666,0.01295072,0.01265873,0.01237972
,0.01211282,0.01185736,0.0116126,0.0113779,0.01115275,0.01093664
,0.01072907,0.01052961,0.01033789,0.01015348,0.00997605,0.00980525
,0.00964074,0.00948222,0.00932941,0.00903979,0.00876981,0.00851762
,0.00828157,0.00806014,0.007852,0.00765596,0.00747094,0.00729641
,0.00713033,0.00697315,0.00682382,0.00668173,0.00654638,0.00641728
,0.00629401,0.00617618,0.00606343,0.00595546,0.00585196,0.00575268
,0.00565736,0.00556579,0.00547778,0.00539458,0.00531167,0.00523326
,0.00515774,0.00508498,0.00501484,0.00494722,0.00488199,0.00481905
,0.0047583,0.00469963,0.00464296,0.00458821,0.00453529,0.00448415
,0.0044347,0.00438691,0.00434072,0.00429608,0.00425296,0.00421132])
        self.List_Lambda_UPC5_s = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_UPC5_d = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_IPC5_s = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_IPC5_d = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_BPC5_s = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_BPC5_d = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_SSC5_s = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_SSC5_d = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_SSC6_s = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_SSC6_d = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_UPC6_s = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_UPC6_d = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_IPC6_s =np.array([0.12310329,0.12144236,0.11657034,0.10987663,0.10373741,0.09942245,0.09671811,0.09496396,0.09365002,0.0924937,0.09136266,0.09019543,0.08898129,0.08770465,0.08641186,0.08508336,0.08373234,0.08238538,0.08102862,0.07968733,0.07835375,0.07704691,0.07577672,0.07452155,0.07331145,0.07208599,0.0709575,0.06979567,0.06875576,0.06769181,0.06667486,0.0656549,0.06473285,0.06379985,0.06287546,0.06199538,0.06119426,0.06036768,0.05957499,0.05878382,0.05809,0.05732795,0.05662972,0.05596964,0.05529041,0.05466716,0.05401502,0.05344701,0.05284296,0.05226934,0.05173172,0.05065156,0.04965752,0.04872991,0.04787872,0.04699772,0.04621047,0.04537889,0.04468329,0.04385155,0.043192,0.0424876,0.04188738,0.04120736,0.04065045,0.04014427,0.03954396,0.03920386,0.03853931,0.03811121,0.03764051,0.03707378,0.03670622,0.03632967,0.03574032,0.03537215,0.03508767,0.03474051,0.03430873,0.03404659,0.03371386,0.03329346,0.0330045,0.03256172,0.03232959,0.03208799,0.03156169,0.03140591,0.03129422,0.03082816,0.03041388,0.03036698,0.0300111,0.02976758,0.02954738,0.02919338])
        # self.List_Lambda_IPC6_d =np.array([0.11216879,0.11167054,0.10967577,0.10636716,0.10296062,0.10033642,0.09852032,0.09719708,0.09609242,0.09504588,0.09397982,0.09286236,0.09168976,0.09046499,0.08919778,0.08789939,0.08658128,0.08525097,0.08391965,0.0825927,0.08128126,0.07997944,0.07869751,0.07744171,0.0762061,0.07500998,0.07382739,0.0726845,0.07156145,0.07046981,0.06940606,0.06837978,0.06737171,0.06639633,0.06545256,0.06453141,0.06363418,0.06276436,0.06191724,0.06109785,0.06029277,0.05952068,0.05876502,0.05803451,0.05731359,0.05660979,0.05593741,0.05527135,0.05463465,0.05400049,0.05339207,0.05221903,0.05108468,0.05002059,0.04898126,0.04802008,0.04707215,0.04620043,0.04532957,0.04454515,0.0437403,0.04300972,0.04227217,0.04158331,0.04090669,0.0402542,0.03963896,0.03901907,0.03845354,0.03788654,0.03735583,0.03683166,0.03631286,0.03582154,0.03534098,0.03487668,0.03444421,0.03399621,0.03357222,0.03315759,0.03274866,0.0323743,0.03198693,0.03162222,0.03126198,0.03092283,0.0306084,0.03026589,0.02990484,0.02960395,0.02931601,0.02901636,0.02871965,0.02842101,0.02814258,0.0278806])
        self.List_Lambda_IPC6_d = np.array([-0.07386896,-0.072637,-0.06778322,-0.06181024,-0.05632651,-0.05249874
,-0.05020026,-0.04885303,-0.04801753,-0.04743187,-0.04694689,-0.04649471
,-0.04604549,-0.04558333,-0.04510495,-0.04461288,-0.04410861,-0.04359516
,-0.04307716,-0.04255753,-0.04203863,-0.04152348,-0.04101406,-0.04051148
,-0.04001721,-0.03953245,-0.03905756,-0.03859306,-0.03813947,-0.03769675
,-0.03726486,-0.03684392,-0.03643379,-0.03603417,-0.03564494,-0.03526587
,-0.0348966,-0.03453685,-0.03418642,-0.03384493,-0.03351206,-0.03318759
,-0.03287119,-0.03256253,-0.03226138,-0.03196749,-0.03168055,-0.03140033
,-0.0311266,-0.03085911,-0.03059763,-0.03009191,-0.02960781,-0.02914387
,-0.02869874,-0.0282712,-0.02786012,-0.02746446,-0.0270833,-0.02671577
,-0.02636107,-0.02601847,-0.02568729,-0.02536693,-0.02505679,-0.02475635
,-0.02446511,-0.02418261,-0.02390842,-0.02364216,-0.02338343,-0.02313191
,-0.02288725,-0.02264916,-0.02241735,-0.02219154,-0.0219715,-0.02175698
,-0.02154776,-0.02134362,-0.02114436,-0.02094981,-0.02075977,-0.02057409
,-0.02039259,-0.02021514,-0.02004157,-0.01987177,-0.0197056,-0.01954293
,-0.01938364,-0.01922763,-0.01907479,-0.01892501,-0.0187782,-0.01863426])
        self.List_Lambda_BPC6_s =np.array([0.08026396,0.07952103,0.07715143,0.07236875,0.06631226,0.06055966,0.05581815,0.05203527,0.04893017,0.04624853,0.04384362,0.04163399,0.03957464,0.03764868,0.03585629,0.03417619,0.03261445,0.03115697,0.0298004,0.02853699,0.02736851,0.02627047,0.02525523,0.0243091,0.02342613,0.02259776,0.02183165,0.02111152,0.02043794,0.01980126,0.01920549,0.01865463,0.01812784,0.01762802,0.01716224,0.01672297,0.01630003,0.01590414,0.01554017,0.01517741,0.01484992,0.01452591,0.01422473,0.01391352,0.0136348,0.01338368,0.01311142,0.012873,0.01263684,0.01241115,0.01217262,0.01178691,0.01138513,0.01102105,0.0106979,0.01038579,0.01009016,0.00979184,0.00953616,0.00926394,0.00903732,0.00880666,0.00856742,0.0083728,0.00816236,0.00796148,0.0077493,0.00758912,0.00742766,0.00726187,0.00706341,0.00694778,0.00676938,0.00664177,0.0064701,0.00632618,0.00624485,0.00611921,0.00597871,0.00584104,0.0057172,0.00559175,0.00550774,0.0054189,0.00531175,0.0052188,0.00516243,0.00506204,0.00490815,0.00487727,0.00480125,0.00471231,0.00463878,0.00453782,0.00449701,0.00438646])
        # self.List_Lambda_BPC6_d =np.array([0.05221718,0.05319834,0.05544405,0.05805261,0.06014498,0.06127995,0.06141786,0.06073663,0.05948041,0.05786926,0.05607749,0.05423105,0.05241157,0.0506662,0.04901979,0.04748107,0.04605004,0.04472406,0.04349554,0.04235692,0.04130022,0.04031594,0.03939955,0.03854326,0.03774138,0.03698917,0.03628041,0.03561145,0.03498289,0.0343833,0.03381629,0.03327442,0.03276423,0.03226932,0.03179966,0.03134997,0.03091941,0.03050585,0.03010631,0.0297234,0.02935159,0.02899792,0.02865309,0.02831878,0.02799812,0.02768689,0.02738499,0.02709211,0.02680536,0.02652869,0.0262668,0.02574945,0.02526262,0.02479569,0.02436064,0.02394234,0.02355166,0.02316502,0.02280178,0.02244677,0.02210951,0.02179021,0.02148886,0.02118521,0.02090392,0.02063782,0.02038492,0.02013086,0.01988012,0.01964705,0.0194227,0.01920453,0.01898595,0.01878678,0.0185815,0.01837528,0.0182044,0.01802076,0.01783322,0.01765775,0.01748501,0.01731997,0.01716086,0.01700444,0.01685766,0.01669562,0.0165674,0.01644555,0.01626818,0.01611639,0.01602031,0.01588279,0.01575411,0.01564269,0.01547934,0.01541882])
        self.List_Lambda_BPC6_d = np.array([-0.01927547,-0.02014166,-0.02175381,-0.02478438,-0.02817094,-0.03104806
,-0.03294567,-0.03377988,-0.03374507,-0.03312549,-0.03214883,-0.03098716
,-0.02975568,-0.02851994,-0.02731944,-0.02617643,-0.02509888,-0.02408912
,-0.02314687,-0.02226853,-0.02144951,-0.02068569,-0.01997245,-0.01930511
,-0.01867979,-0.01809287,-0.01754074,-0.01702038,-0.01652914,-0.01606444
,-0.01562403,-0.015206,-0.01480856,-0.01443004,-0.01406905,-0.01372432
,-0.01339462,-0.01307892,-0.01277631,-0.01248587,-0.01220683,-0.01193849
,-0.0116802,-0.01143133,-0.01119137,-0.01095982,-0.0107362,-0.01052009
,-0.01031113,-0.01010892,-0.00991313,-0.00953965,-0.00918841,-0.00885749
,-0.00854518,-0.00824999,-0.0079706,-0.00770584,-0.00745469,-0.00721624
,-0.00698967,-0.00677429,-0.00656943,-0.00637454,-0.00618911,-0.00601272
,-0.0058449,-0.00568499,-0.00553221,-0.00538592,-0.00524562,-0.00511089
,-0.00498141,-0.00485686,-0.00473697,-0.0046215,-0.00451023,-0.00440294
,-0.00429943,-0.00419953,-0.00410306,-0.00400986,-0.00391977,-0.00383266
,-0.00374838,-0.00366681,-0.00358781,-0.00351128,-0.00343709,-0.00336514
,-0.0032953,-0.00322711,-0.00316017,-0.00309504,-0.00303172,-0.00297016])
        self.List_Lambda_TPC6_s =np.array([0.17771313,0.17771313,0.17328037,0.16434688,0.15331892,0.14355911,0.13396699,0.12627959,0.11999561,0.11462686,0.10984853,0.10548252,0.10140853,0.09689507,0.09309764,0.08979571,0.08668796,0.08375942,0.08101637,0.07842864,0.07600289,0.07369504,0.07211233,0.07004943,0.06809735,0.0662838,0.06452937,0.06285823,0.06134222,0.05984727,0.05843637,0.05711877,0.05556685,0.05425091,0.05307891,0.05197819,0.05096223,0.04996484,0.04899219,0.04806539,0.04713566,0.04633172,0.04581943,0.04497523,0.04419889,0.04351636,0.04277227,0.04210366,0.04137907,0.04076013,0.04013148,0.03871115,0.0376242,0.03661964,0.03555074,0.03465409,0.03392693,0.03313029,0.03229346,0.03163248,0.03084861,0.03002737,0.02938742,0.02866383,0.0280892,0.02756253,0.02721857,0.02674374,0.02612214,0.02566062,0.02525585,0.024576,0.02423356,0.02382562,0.02340293,0.02290236,0.02272075,0.02242561,0.02204084,0.02163082,0.02121524,0.02077845,0.02054411,0.02028964,0.0200168,0.01972679,0.01970797,0.01940343,0.01890281,0.01885887,0.01866139,0.01829863,0.01807868,0.01773321,0.01763507,0.01738596])
        # self.List_Lambda_TPC6_d =np.array([0.15218075,0.15218075,0.15158791,0.14847841,0.14360971,0.13888312,0.13318268,0.12804295,0.12340181,0.11902255,0.11483073,0.11076221,0.1068044,0.10283103,0.09913219,0.09582139,0.09269357,0.08973164,0.08694942,0.08433174,0.08188308,0.07961082,0.07752159,0.07551075,0.07355661,0.07168322,0.06992591,0.06825086,0.06666081,0.06514488,0.0636986,0.06232459,0.06096855,0.05965871,0.05846528,0.05734485,0.05628027,0.05525638,0.05428534,0.05335298,0.0524615,0.05161352,0.05084083,0.05005613,0.04927754,0.04851946,0.04778803,0.04708551,0.0463996,0.04573584,0.0450884,0.04381845,0.0426478,0.04158702,0.04060078,0.03966438,0.03882889,0.03797973,0.03716907,0.03636879,0.03562422,0.03487628,0.03418379,0.03355191,0.0329388,0.03236944,0.03183484,0.03133023,0.03080476,0.03030123,0.02978693,0.02931553,0.02884075,0.02841677,0.02799937,0.02762715,0.02728565,0.02689812,0.02654896,0.02621304,0.02587442,0.02552544,0.02518392,0.02486693,0.02454388,0.02428633,0.02402134,0.02370556,0.02348114,0.02324245,0.02292507,0.02268444,0.02242873,0.0221938,0.02200481,0.02172563])
        self.List_Lambda_TPC6_d = np.array([0.11178056,0.11006048,0.10530428,0.09680514,0.08673206,0.07736852
,0.06985034,0.06421988,0.06001594,0.05677087,0.054157,0.05195605
,0.05003803,0.04833101,0.04678788,0.04537786,0.0440808,0.04287927
,0.04176021,0.04071519,0.03973639,0.03881686,0.0379517,0.03713609
,0.03636518,0.03563543,0.0349436,0.03428619,0.03366054,0.03306449
,0.03249545,0.03195136,0.03143069,0.03093163,0.03045252,0.02999225
,0.0295496,0.0291232,0.02871217,0.02831571,0.02793275,0.02756254
,0.02720454,0.02685795,0.02652209,0.02619657,0.02588084,0.02557427
,0.02527654,0.0249873,0.024706,0.02416607,0.02365415,0.02316809
,0.02270567,0.02226532,0.02184531,0.02144424,0.02106094,0.02069406
,0.02034273,0.02000587,0.0196826,0.0193722,0.01907378,0.01878681
,0.01851057,0.01824447,0.01798806,0.01774071,0.01750207,0.01727162
,0.01704894,0.01683374,0.01662552,0.01642408,0.01622902,0.01604006
,0.01585699,0.01567942,0.01550722,0.01534009,0.01517779,0.01502017
,0.01486694,0.01471799,0.0145731,0.01443209,0.01429486,0.01416118
,0.01403096,0.01390404,0.01378026,0.01365955,0.01354172,0.01342673])
        self.List_Lambda_PV1=np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_PV23= np.array([0.05044495,0.05060706,0.04936075,0.04827363,0.04793822,0.04841018,0.04942355,0.05067723,0.0519533,0.05313785,0.054179,0.0550591,0.05578768,0.05638264,0.05685136,0.0572162,0.05749763,0.05769562,0.05783453,0.05791466,0.05795802,0.05794666,0.05790781,0.05783912,0.05773854,0.05762749,0.0574983,0.05735529,0.05719412,0.05700938,0.05682943,0.05664074,0.05640734,0.05622135,0.05601155,0.05577685,0.05558313,0.05530895,0.05510684,0.05490801,0.05462466,0.05445436,0.054247,0.05397586,0.05378747,0.05352868,0.05326463,0.05310842,0.05279731,0.05262271,0.05246154,0.05200478,0.05154187,0.05117027,0.05070441,0.05028176,0.04994407,0.04951035,0.0491276,0.04867513,0.04825806,0.0479426,0.04756107,0.04729675,0.04694969,0.04645419,0.04628306,0.04578774,0.04546437,0.04513879,0.04498968,0.04433144,0.04429381,0.04398867,0.0434967,0.04311325,0.04300538,0.0427574,0.04244604,0.04228622,0.0420487,0.0417396,0.04148841,0.04113966,0.04068139,0.0406316,0.04041385,0.03957292,0.03971865,0.03971586,0.03910398,0.03885864,0.03881632,0.03841208,0.03843609,0.03793229])
        self.List_Lambda_PV4= np.array([0.02698535,0.02684294,0.02623582,0.02563545,0.02534042,0.02541104,0.02573903,0.02618046,0.02663261,0.02703925,0.02737766,0.02764264,0.02783826,0.02797401,0.02805138,0.02808485,0.02807959,0.02804415,0.02797709,0.02788901,0.02777722,0.02765638,0.02751967,0.02737387,0.02721684,0.02704826,0.02688574,0.0267259,0.02654365,0.02636833,0.02619041,0.02600886,0.02584718,0.02565795,0.02548608,0.02532017,0.02513572,0.02498633,0.02481957,0.02465669,0.02450545,0.02433251,0.02418969,0.02402496,0.02390505,0.02376298,0.02361136,0.02349425,0.02332665,0.02321428,0.02311914,0.02287684,0.02263159,0.02244793,0.02220594,0.02202741,0.02189004,0.02168525,0.0215876,0.02138951,0.0212706,0.02110338,0.02103688,0.02086625,0.02076557,0.02072749,0.02057315,0.0205753,0.02049726,0.02040642,0.02027506,0.02030649,0.02013726,0.02009797,0.02011628,0.02005017,0.0199206,0.01986324,0.01982612,0.01972086,0.01958846,0.01956228,0.01961881,0.01957859,0.01956497,0.01945541,0.01935231,0.01953098,0.01948973,0.01922607,0.01926508,0.01931365,0.01927368,0.0192284,0.01915881,0.01908201])
        self.List_Lambda_PV5= np.array([0.03626328,0.0358136,0.0347426,0.03362416,0.03294583,0.03283718,0.03316143,0.03371427,0.03433972,0.03494448,0.03548425,0.03594393,0.03632607,0.03663379,0.03687056,0.03705058,0.03717838,0.0372631,0.03731191,0.03732918,0.03731712,0.03728309,0.03722636,0.03714948,0.0370578,0.03695418,0.03682328,0.03667725,0.03654505,0.03640263,0.03624312,0.03608194,0.03591717,0.03574535,0.03555703,0.03537893,0.03516969,0.03499241,0.03480041,0.03461048,0.03442049,0.03419745,0.034002,0.03378305,0.03358145,0.03341884,0.03320895,0.03300472,0.03279431,0.03258272,0.0323845,0.03195074,0.03157733,0.03119302,0.03080923,0.03041271,0.03002717,0.02964852,0.02923694,0.028904,0.02848634,0.02819673,0.02778989,0.02753209,0.02719793,0.02679312,0.02655354,0.02615879,0.02584352,0.02554173,0.02534328,0.02486756,0.02473712,0.0244536,0.02412261,0.02368302,0.02353855,0.02340214,0.02304739,0.02288519,0.02266252,0.0224844,0.02245941,0.02230479,0.02230588,0.02224485,0.02201484,0.02194997,0.02200554,0.02186404,0.02162225,0.02163438,0.02147608,0.0213359,0.02144788,0.02101155])
        self.List_Lambda_PV6= np.array([0.05440403,0.05231709,0.05029164,0.04872302,0.04896866,0.05085482,0.05326916,0.05538756,0.05690596,0.05781436,0.05820856,0.05819157,0.05788109,0.05733643,0.05664316,0.05583632,0.05495095,0.05401122,0.053064,0.05209569,0.05111677,0.05017043,0.0492375,0.04832156,0.0474255,0.046575,0.04572975,0.04492511,0.04415566,0.04339068,0.04267403,0.04197154,0.04132704,0.04092762,0.04073639,0.04052693,0.0403163,0.04009806,0.03989729,0.03970165,0.03949405,0.03925222,0.03901917,0.0387968,0.03858555,0.03839627,0.03817916,0.03791572,0.03774287,0.03750676,0.03719206,0.03679313,0.0363939,0.03590586,0.03552,0.03508397,0.03462887,0.03427601,0.03388776,0.03347016,0.03313006,0.03270721,0.03229585,0.03186588,0.03150615,0.03121589,0.03079488,0.03056351,0.03024261,0.02990406,0.02942878,0.02930353,0.02884334,0.02857617,0.02835608,0.02808453,0.02771862,0.02734617,0.02708449,0.02675222,0.02645439,0.02627493,0.02593774,0.02575149,0.02548892,0.02525819,0.02502798,0.02499385,0.02462565,0.0244227,0.02439089,0.02425797,0.02422103,0.02416149,0.02397932,0.02424439])
        self.List_Lambda_SST1=np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_SST23= np.array([0.06251183,0.06645659,0.07620865,0.08493189,0.0906891,0.09415808,0.09620686,0.09738952,0.09801999,0.09829314,0.09830956,0.09814455,0.09782675,0.09740965,0.09690047,0.09631676,0.09565965,0.09496938,0.09421055,0.09342537,0.09262663,0.09176395,0.09088701,0.08999959,0.08908736,0.08818958,0.08722741,0.08625442,0.0853495,0.0843971,0.08344384,0.08251144,0.08150693,0.08056167,0.07962177,0.07868817,0.07778564,0.07684802,0.07590999,0.07497275,0.07410762,0.07315577,0.07224607,0.07138777,0.07052265,0.06974446,0.06891486,0.06804808,0.06725926,0.06642943,0.06563628,0.06412702,0.06258704,0.06118458,0.05969407,0.05828252,0.05702189,0.05569978,0.05459287,0.05325857,0.0522272,0.05099264,0.04997467,0.04892936,0.04794878,0.04699935,0.04615106,0.04576676,0.04530384,0.04489761,0.04470902,0.04412581,0.04393006,0.04364134,0.04313686,0.04297827,0.04277128,0.04224227,0.04211725,0.04189114,0.04163565,0.04135707,0.04103381,0.04070781,0.04032061,0.04004196,0.03998156,0.03933988,0.03898297,0.03917211,0.03880514,0.0384745,0.03835243,0.03785287,0.0378101,0.03766968])
        self.List_Lambda_SST4= np.array([0.0273666,0.03707936,0.04823581,0.05384106,0.05639206,0.05761168,0.05823735,0.05857174,0.05874249,0.05881134,0.05880878,0.05875138,0.05866617,0.05854699,0.05839827,0.05823973,0.05807393,0.0579018,0.0577155,0.05753257,0.05735382,0.05716686,0.0569921,0.05681761,0.05664129,0.05648007,0.05632661,0.05616685,0.05601149,0.05587925,0.05573252,0.05560143,0.05548665,0.05536854,0.05523924,0.05512988,0.05498026,0.05488427,0.05478248,0.05471498,0.05460866,0.05448324,0.05442811,0.05429308,0.05426305,0.05418046,0.05407576,0.05401966,0.05389628,0.05381067,0.05377776,0.05358256,0.05345699,0.05334579,0.05321937,0.05307076,0.05290548,0.05272591,0.05250341,0.05253713,0.05236479,0.05229588,0.05208428,0.05198622,0.05183094,0.05165827,0.05145289,0.05148587,0.05120996,0.05115308,0.05070258,0.05090075,0.05069866,0.05048445,0.05041099,0.05041004,0.05016938,0.04987637,0.04966537,0.04943145,0.04921483,0.04919204,0.04923178,0.04896184,0.04885163,0.0485586,0.04827607,0.04871755,0.04851493,0.04778325,0.04793778,0.04794578,0.04780782,0.04766114,0.04740564,0.04719307])
        self.List_Lambda_SST5= np.array([0.05844359,0.06209096,0.06855699,0.07449655,0.07914679,0.08329944,0.08584208,0.08729453,0.088022,0.08825373,0.08814662,0.08779523,0.08727171,0.08662872,0.08588464,0.08508683,0.0842523,0.08339577,0.08250879,0.08162224,0.08076427,0.07988565,0.07903274,0.07820176,0.07739404,0.07660752,0.0758277,0.07509071,0.07436873,0.07364707,0.07298956,0.07231712,0.07173496,0.07110762,0.07053347,0.06998262,0.06939327,0.06887201,0.06838388,0.06794546,0.06740705,0.06702623,0.0666103,0.06617318,0.06578168,0.06530332,0.06491977,0.06455419,0.0642537,0.06387484,0.06352605,0.06288888,0.06229296,0.06160673,0.06116829,0.06063543,0.06001058,0.05959003,0.05901263,0.05875945,0.05828598,0.05792065,0.05740329,0.05708625,0.05668895,0.05622199,0.05589374,0.05554772,0.05502421,0.05463528,0.0544432,0.05382456,0.05364836,0.05337063,0.05281782,0.05267135,0.0524922,0.0519572,0.05182676,0.05162264,0.05136994,0.05107298,0.05074928,0.05039137,0.04993836,0.04972221,0.04963772,0.04879068,0.04860686,0.04880949,0.04829625,0.04795932,0.04787896,0.04733529,0.04734721,0.04705092])
        self.List_Lambda_SST6= np.array([0.05325657,0.05611093,0.06295016,0.07104769,0.07727379,0.08133133,0.0838416,0.08535161,0.08622678,0.08666936,0.08681675,0.08675181,0.08653146,0.08619361,0.08575714,0.08525061,0.08468843,0.08407514,0.08344056,0.08277229,0.08206399,0.081363,0.08063649,0.0798955,0.07917072,0.07841324,0.07766783,0.07694044,0.07618172,0.07542066,0.07469745,0.07394087,0.07325863,0.0724992,0.0718215,0.07111374,0.07037778,0.06973514,0.06905166,0.06840024,0.06774171,0.06705491,0.06646739,0.06576826,0.06519048,0.06458868,0.06394063,0.06342351,0.06275057,0.06224308,0.06174043,0.06064594,0.05953941,0.05848952,0.05746396,0.05653078,0.05553892,0.05473847,0.05383478,0.05312631,0.05234314,0.05159387,0.05076331,0.0500977,0.04940033,0.04865463,0.0480528,0.04739711,0.046682,0.04605222,0.04565536,0.04476305,0.04449304,0.04396523,0.04333369,0.04253103,0.04223937,0.04200957,0.04137633,0.04101629,0.04060126,0.04005276,0.03972881,0.03923212,0.0390159,0.03864849,0.03795512,0.03794108,0.03772407,0.03706891,0.03662342,0.03658949,0.03618589,0.0359237,0.03554666,0.03525489])
        self.List_Lambda_VIP1=np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_VIP23= np.array([0.00545704,0.00640503,0.00857294,0.01096654,0.01289861,0.01427281,0.01521675,0.01586913,0.01632962,0.01666167,0.0169078,0.01709301,0.01723814,0.01734865,0.01743887,0.01751059,0.01756917,0.01761877,0.01765639,0.017688,0.01771908,0.0177372,0.01775746,0.01777253,0.01778312,0.0177981,0.0178049,0.01780598,0.0178145,0.01781556,0.0178181,0.0178196,0.01782697,0.01782154,0.01781695,0.01781747,0.01781159,0.01782038,0.01781272,0.01779858,0.01780072,0.01779037,0.01778322,0.01778741,0.01776318,0.01774956,0.01774256,0.01774207,0.01772025,0.01772587,0.01773455,0.01771298,0.01767581,0.01767529,0.01764189,0.01761777,0.01759937,0.01753651,0.01750503,0.01752091,0.0174801,0.01747387,0.0174183,0.01739273,0.01734977,0.01730982,0.01723066,0.01728835,0.01722472,0.01720016,0.01705019,0.01714844,0.01703057,0.01700727,0.01702992,0.01697795,0.01685903,0.01685666,0.01681213,0.01670944,0.01664122,0.01655026,0.01658218,0.01655962,0.0165749,0.01654026,0.01637945,0.01640351,0.01645516,0.01636454,0.01621169,0.01624191,0.01613992,0.01606716,0.01616736,0.01585372])
        self.List_Lambda_VIP4= np.array([0.14632504,0.14719517,0.15118341,0.16531537,0.18373185,0.19933657,0.21032673,0.21745302,0.22180962,0.22426735,0.22537178,0.22550264,0.22492794,0.22383953,0.22249772,0.22092954,0.2191126,0.21711274,0.21493236,0.21265467,0.2102007,0.20776823,0.2052423,0.20265205,0.20007786,0.19742571,0.19477939,0.19217705,0.18951783,0.18682552,0.18426167,0.18160692,0.17914443,0.1766155,0.17409356,0.17161409,0.16908686,0.16676111,0.1643827,0.16215298,0.15980227,0.15760997,0.15549969,0.15334581,0.15122824,0.14897822,0.14696575,0.14497729,0.14316675,0.14120867,0.13928949,0.13566247,0.13226069,0.12894959,0.12596361,0.12289196,0.12003854,0.11716424,0.11452918,0.11166865,0.10917501,0.10669034,0.10469937,0.10220672,0.10011441,0.09824363,0.09643976,0.09476093,0.09269788,0.09105321,0.08920291,0.08778141,0.08596781,0.08461337,0.08277939,0.08145252,0.08058648,0.0791229,0.07760442,0.0765804,0.07539121,0.07416887,0.07298386,0.07204881,0.07124191,0.07006521,0.06916729,0.06862983,0.06762998,0.06599599,0.06572368,0.06475412,0.06388643,0.0634274,0.06205942,0.06215147])
        self.List_Lambda_VIP5= np.array([0.01820963,0.02283536,0.02869995,0.03205955,0.03379123,0.03473014,0.03528237,0.03563327,0.03587112,0.03604264,0.03616984,0.03627092,0.03635629,0.03642446,0.03648419,0.03653419,0.03658019,0.036616,0.03665713,0.03668322,0.03671632,0.03674011,0.03675819,0.03677425,0.03679054,0.03680259,0.03679976,0.03679234,0.03679777,0.03680248,0.03679226,0.03678052,0.03678665,0.03676544,0.03673501,0.03673019,0.03668367,0.03669232,0.03666257,0.03660451,0.03660838,0.03654304,0.0364865,0.0364827,0.03641323,0.03638482,0.03635305,0.03627362,0.03626678,0.0361928,0.03612052,0.03603585,0.03591848,0.03577069,0.03561736,0.03550039,0.0354047,0.03520743,0.03514595,0.03489998,0.03473948,0.03455275,0.03447882,0.03433243,0.03418116,0.03394666,0.03388081,0.03358419,0.033433,0.03326114,0.03321345,0.03279514,0.03280349,0.032639,0.03229253,0.03219445,0.03213185,0.0318477,0.03177373,0.03166109,0.03151628,0.03135197,0.03125163,0.03106021,0.03090999,0.03093043,0.03076531,0.03028037,0.03049935,0.03050367,0.0300537,0.0299594,0.0300062,0.02976106,0.02983369,0.0295362])
        self.List_Lambda_VIP6=np.array([0.01695433,0.02110829,0.02646745,0.02958435,0.03119809,0.03206718,0.03256749,0.0328743,0.03307006,0.0332009,0.0332859,0.03334817,0.0333906,0.03341798,0.03343872,0.03345011,0.03345962,0.03346074,0.03346832,0.03346637,0.03346778,0.03346838,0.03346545,0.03346247,0.0334623,0.03346251,0.03344969,0.03343545,0.03344357,0.03343707,0.03342796,0.03343717,0.03341929,0.03342953,0.03341926,0.03341049,0.03338538,0.03337843,0.03337408,0.03338299,0.03337322,0.03334228,0.03333775,0.03330728,0.03331811,0.0333192,0.03330049,0.03327027,0.03326672,0.03323911,0.03317742,0.03313144,0.03310418,0.03300879,0.03300792,0.03292979,0.03280671,0.03283257,0.03273919,0.03262541,0.03259582,0.03244656,0.03240109,0.03221814,0.03212735,0.03213682,0.03201538,0.03187322,0.03181504,0.0316517,0.031673,0.03147186,0.03143356,0.03129397,0.03115612,0.03078365,0.03080628,0.03083527,0.03062549,0.03061473,0.0305284,0.0303798,0.03028193,0.03010136,0.02984394,0.0298534,0.02978386,0.02925388,0.02930236,0.02941918,0.02912722,0.02896459,0.02894339,0.02862591,0.02863617,0.02857006])
        self.List_Lambda_RLN1= np.array([0.00132179,0.00166557,0.00243058,0.00315795,0.00369655,0.00405478,0.00428704,0.00444049,0.00454507,0.00462002,0.0046752,0.00471819,0.00475327,0.00478195,0.00480779,0.00483042,0.00485118,0.00487103,0.00488944,0.0049081,0.00492511,0.00494393,0.00496134,0.00497874,0.0049966,0.00501377,0.00503322,0.00505376,0.00507201,0.00509045,0.00511078,0.00513069,0.00514752,0.00517038,0.00519064,0.00520979,0.00522858,0.00525061,0.00527287,0.00529448,0.00531858,0.00533629,0.00535454,0.00538086,0.00539919,0.00541997,0.00544644,0.00546456,0.00549102,0.00550859,0.00553579,0.00558208,0.00561815,0.00567041,0.00570968,0.00575316,0.00579548,0.00583083,0.00585994,0.00591961,0.0059598,0.00599595,0.00602177,0.00604542,0.00608181,0.00613486,0.00616265,0.00618798,0.00622589,0.00625264,0.00630776,0.0062924,0.00633945,0.00637913,0.00636998,0.00641636])
        self.List_Lambda_RLN23= np.array([0.0023717,0.00284465,0.00395159,0.00503477,0.0058394,0.0063722,0.00671641,0.00694322,0.00709847,0.00720925,0.00729195,0.00735636,0.00740879,0.00745161,0.00749056,0.00752443,0.00755488,0.00758356,0.00761008,0.00763638,0.00765801,0.00768468,0.00770808,0.00773053,0.00775304,0.00777429,0.00779553,0.00781767,0.00783601,0.00785601,0.00787831,0.0078966,0.0079132,0.00793307,0.00795321,0.00797005,0.00799069,0.00799819,0.00802107,0.00804326,0.00805762,0.00807012,0.0080891,0.00809987,0.00812015,0.00813327,0.0081547,0.00816121,0.00818456,0.00819499,0.00819101,0.00822824,0.00825926,0.00827515,0.00829542,0.00832159,0.00835654,0.00836433,0.00840057,0.00839982,0.00841549,0.00844839,0.00845508,0.00849446,0.00850971,0.0085108,0.00852768,0.00854982,0.00853674,0.00856927,0.00853619,0.00859953,0.00859723,0.00859804,0.00862624,0.00864766])
        self.List_Lambda_RLN4=np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_RLN5 = np.zeros(len(self.List_Lambda_freqs))
        self.List_Lambda_RLN6 = np.zeros(len(self.List_Lambda_freqs))
        self.PCsubtypes_Percentage=np.array([[0,0,0,0,0],
                                      [0.9,0,0.1,0,0],
                                      [0.5,0.36,0,0,0.14],
                                      [0.81,0.19,0,0,0],
                                      [0.39,0.17,0.20,0.24,0]]) #TPC,UPC,IPC,BPC,SSC

        # self.PCsubtypes_Per=np.array([[0,0,0,0,0],
        #                               [0.9*self.NB_PYR[1],0,0.1*self.NB_PYR[1],0,0],
        #                               [0.5*self.NB_PYR[2],0.36*self.NB_PYR[2],0,0,0.14*self.NB_PYR[2]],
        #                               [self.NB_PYR[3]*0.81,self.NB_PYR[3]*0.19,0,0,0],
        #                               [self.NB_PYR[4]*0.39,self.NB_PYR[4]*0.17,self.NB_PYR[4]*0.20,self.NB_PYR[4]*0.24,0]]) #TPC,UPC,IPC,BPC,SSC
        self.PCsubtypes_Per= self.PCsubtypes_Percentage * self.NB_PYR[:, np.newaxis]
        # self.List_celltypes = np.array([np.array([0]*self.Layer_nbCells_pertype[0][l] + [1]*self.Layer_nbCells_pertype[1][l] + [2]*self.Layer_nbCells_pertype[2][l] + [3]*self.Layer_nbCells_pertype[3][l] + [4]*self.Layer_nbCells_pertype[4][l]).astype(int) for l in range(len(self.Layer_nbCells))])
        self.List_celltypes =np.array([np.array(
            [0] * self.Layer_nbCells_pertype[0][l] + [1] * self.Layer_nbCells_pertype[1][l] + [2] *
            self.Layer_nbCells_pertype[2][l] + [3] * self.Layer_nbCells_pertype[3][l] + [4] *
            self.Layer_nbCells_pertype[4][
                l]).astype(int) for l in range(len(self.Layer_nbCells))], dtype='object')
        self.GetCellsubtypes()
        #compute index for all column
        nbcells = np.sum(self.Layer_nbCells)
        self.layerS = np.zeros(nbcells,dtype=int)
        self.typeS = np.zeros(nbcells,dtype=int)
        self.indexS = np.zeros(nbcells,dtype=int)
        for ind in range(nbcells):
            self.layerS[ind], self.typeS[ind], self.indexS[ind] = self.All2layer(ind, self.Layer_nbCells, self.NB_PYR, self.NB_PV, self.NB_SST, self.NB_VIP,
                                               self.NB_RLN, self.List_celltypes)

    def update_morphology(self,L=None,
                          D=None,
                          Curvature=None,
                          L_th=None,
                          Layer_nbCells=None,
                          PYRpercent=None,  
                        PVpercent=None, 
                          SSTpercent=None, 
                          VIPpercent=None, 
                          RLNpercent=None, 
                          NB_PYR = None,
                            NB_PV_BC = None,
                            NB_PV_ChC = None,
                            NB_IN = None,
                            NB_PV = None,
                            NB_SST = None,
                            NB_VIP = None,
                            NB_RLN = None
    ):
        if not L is None:
            self.L=L
        #Column diameter 
        if not D is None:
            self.D=D

        # Column Curvature 
        if not Curvature is None:
            self.Curvature = Curvature 
        #thickness of each layer of the column 
        if not L_th is None:
            self.L_th=L_th
        #Number of synapses per cell for each column 
        #cell number in each layer 
        if not Layer_nbCells is None:
            self.Layer_nbCells=Layer_nbCells 
        #from Markram et al. 2015 rat model
        if not PYRpercent is None:
            self.PYRpercent=PYRpercent  
        self.INpercent = 1 - self.PYRpercent
        if not PVpercent is None:
            self.PVpercent=PVpercent   
        if not SSTpercent is None:
            self.SSTpercent=SSTpercent   
        if not VIPpercent is None:
            self.VIPpercent=VIPpercent   
        if not RLNpercent is None:
            self.RLNpercent=RLNpercent   
        
        self.GetCelltypes(NB_PYR = NB_PYR,
                            NB_PV_BC = NB_PV_BC,
                            NB_PV_ChC = NB_PV_ChC,
                            NB_IN = NB_IN,
                            NB_PV = NB_PV,
                            NB_SST = NB_SST,
                            NB_VIP = NB_VIP,
                            NB_RLN = NB_RLN)
        # self.Layer_nbCells = np.array([322,7524, 4656, 6114,
        #                           12651]) / d  # markram et al. 2015total number of cells/neocortical column for each layer (L1-L2/3-L4-L5-L6)


        # self.List_Lambda_s= np.array(
        #     [[0.032, 0, 0, -0.032, 0],  # layer II/III-> TPC,UPC,IPC,BPC,SSC
        #      [0.048, 0.048, 0, 0, -0.012],  # layer IV-> TPC,UPC,IPC,BPC,SSC
        #      [0.137, 0.048, 0, 0, 0],  # layer V-> TPC,UPC,IPC,BPC,SSC
        #      [0.117, 0, -0.104,0.024, 0]  # layer VI-> TPC,UPC,IPC,BPC,SSC
        #      ], dtype=np.float)
        # 
        # self.List_Lambda_d= np.array(
        #     [[-0.120, 0, 0,0.120, 0],  # layer II/III-> TPC,UPC,IPC,BPC,SSC
        #      [-0.095, -0.095, 0, 0, 0],  # layer IV-> TPC,UPC,IPC,BPC,SSC
        #      [-0.071, -0.076, 0, 0, 0],  # layer V-> TPC,UPC,IPC,BPC,SSC
        #      [-0.046, 0, 0.047,0.019, 0]  # layer VI-> TPC,UPC,IPC,BPC,SSC
        #      ], dtype=np.float)

        # self.PCsubtypes_Per=np.array([[0,0,0,0,0],
        #                               [0.9*self.NB_PYR[1],0,0.1*self.NB_PYR[1],0,0],
        #                               [0.5*self.NB_PYR[2],0.36*self.NB_PYR[2],0,0,0.14*self.NB_PYR[2]],
        #                               [self.NB_PYR[3]*0.81,self.NB_PYR[3]*0.19,0,0,0],
        #                               [self.NB_PYR[4]*0.39,self.NB_PYR[4]*0.17,self.NB_PYR[4]*0.20,self.NB_PYR[4]*0.24,0]]) #TPC,UPC,IPC,BPC,SSC
        self.PCsubtypes_Per= self.PCsubtypes_Percentage * self.NB_PYR[:, np.newaxis]
        # self.List_celltypes = np.array([np.array([0]*self.Layer_nbCells_pertype[0][l] + [1]*self.Layer_nbCells_pertype[1][l] + [2]*self.Layer_nbCells_pertype[2][l] + [3]*self.Layer_nbCells_pertype[3][l] + [4]*self.Layer_nbCells_pertype[4][l]).astype(int) for l in range(len(self.Layer_nbCells))])
        self.List_celltypes = np.array([np.array( [0] * self.Layer_nbCells_pertype[0][l]
                                                  + [1] * self.Layer_nbCells_pertype[1][l]
                                                  + [2] * self.Layer_nbCells_pertype[2][l]
                                                  + [3] * self.Layer_nbCells_pertype[3][l]
                                                  + [4] * self.Layer_nbCells_pertype[4][l]).astype(int) for l in range(len(self.Layer_nbCells))], dtype='object')
        self.GetCellsubtypes()
        nbcells = np.sum(self.Layer_nbCells)
        self.layerS = np.zeros(nbcells,dtype=int)
        self.typeS = np.zeros(nbcells,dtype=int)
        self.indexS = np.zeros(nbcells,dtype=int)
        for ind in range(nbcells):
            self.layerS[ind], self.typeS[ind], self.indexS[ind] = self.All2layer(ind, self.Layer_nbCells, self.NB_PYR, self.NB_PV, self.NB_SST, self.NB_VIP,
                                               self.NB_RLN, self.List_celltypes)

    def GetCelltypes(self, NB_PYR = None,
                            NB_PV_BC = None,
                            NB_PV_ChC = None,
                            NB_IN = None,
                            NB_PV = None,
                            NB_SST = None,
                            NB_VIP = None,
                            NB_RLN = None): 
        if NB_PYR is None:
            NB_PYR = self.PYRpercent * self.Layer_nbCells
            self.NB_PYR = NB_PYR.astype(int)
        else:
            self.NB_PYR = NB_PYR

        if NB_IN is None:
            NB_IN = self.INpercent * self.Layer_nbCells
            self.NB_IN = NB_IN.astype(int)
        else:
            self.NB_IN =NB_IN

        if NB_PV is None:
            NB_PV = self.PVpercent * self.NB_IN
            self.NB_PV = NB_PV.astype(int)
        else:
            self.NB_PV =NB_PV
        
        if NB_PV_BC is None:
            NB_PV_BC = 0.7 * self.NB_PV
            self.NB_PV_BC = NB_PV_BC.astype(int)
        else:
            self.NB_PV_BC = NB_PV_BC
        if NB_PV_ChC is None:
            NB_PV_BC = 0.7 * self.NB_PV
            self.NB_PV_ChC = (self.NB_PV - self.NB_PV_BC).astype(int)
        else:
            self.NB_PV_ChC = NB_PV_ChC
            
        if NB_SST is None:
            NB_SST = self.SSTpercent * self.NB_IN
            self.NB_SST = NB_SST.astype(int)
            print('SST', self.NB_SST)
        else:
            self.NB_SST = NB_SST
        if NB_VIP is None:
            NB_VIP = self.VIPpercent * self.NB_IN
            self.NB_VIP = NB_VIP.astype(int)
            print('VIP', self.NB_VIP)
        else:
            self.NB_VIP = NB_VIP
        if NB_RLN is None:
            NB_RLN = self.RLNpercent * self.NB_IN
            self.NB_RLN = NB_RLN.astype(int)
            print('RLN', self.NB_RLN)
        else:
            self.NB_RLN = NB_RLN

        #####External afferences
        self.NB_DPYR = int(np.sum(self.NB_PYR) * 0.07)
        self.NB_Th = int(np.sum(self.NB_PYR) * 0.07)
        
        self.Layer_nbCells = self.NB_PYR+self.NB_SST+self.NB_PV+self.NB_VIP+self.NB_RLN  # total number of cells/neocortical column for each layer (L1-L2/3-L4-L5-L6)
        self.Layer_nbCells_pertype=[self.NB_PYR,self.NB_PV,self.NB_SST,self.NB_VIP,self.NB_RLN]


    def GetCellsubtypes(self):
        self.List_cellsubtypes =copy.deepcopy(self.List_celltypes)
        PCsubtypes_Per = np.cumsum(self.PCsubtypes_Per,axis=1)

        for l in range(len(self.Layer_nbCells)):
            for cell in range(int(self.Layer_nbCells[l])):

                if (self.List_celltypes[l][cell] == 0):  # getsubtype of PC
                    if cell < PCsubtypes_Per[l][0]:
                        subtype = 0  # TPC
                    elif (cell >= PCsubtypes_Per[l][0]) and (cell < PCsubtypes_Per[l][1]):
                        subtype = 1  # UPC
                    elif (cell >= PCsubtypes_Per[l][1]) and (cell < PCsubtypes_Per[l][2]):
                        subtype = 2  # IPC
                    elif (cell >= PCsubtypes_Per[l][2]) and (cell < PCsubtypes_Per[l][3]):
                        subtype = 3  # BPC
                    elif (cell >= PCsubtypes_Per[l][3]) and (cell < PCsubtypes_Per[l][4]):
                        subtype = 4  # SSC

                    self.List_cellsubtypes[l][cell] = subtype

                #if PV check is chandeliers or Basket
                elif (self.List_celltypes[l][cell] == 1):  # PV get subtype
                    if (cell - self.NB_PYR[l]) < self.NB_PV_BC[l]:
                        subtype = 0  # BC
                    else:
                        subtype = 1  # Chandelier
                    self.List_cellsubtypes[l][cell] = subtype
                else:
                    self.List_cellsubtypes[l][cell] = -1

    def All2layer(self, indexall, NB_Cells, NB_pyr, NB_PV, NB_SST, NB_VIP, NB_RLN,
                  celltype):  # tranform index of a cell in the network into layer and index in the layer
        layer = []
        new_i = []  # index in the layer
        i = []  # index per type
        if indexall < NB_Cells[0]:  # layer 1
            layer = 0
            new_i = indexall
        elif indexall >= NB_Cells[0:1] and indexall < np.sum(NB_Cells[0:2]):  # layer 2/3
            layer = 1
            new_i = indexall - NB_Cells[0]
        elif indexall >= np.sum(NB_Cells[0:2]) and indexall < np.sum(NB_Cells[0:3]):  # Layer 4
            layer = 2
            new_i = indexall - np.sum(NB_Cells[0:2])
        elif indexall >= np.sum(NB_Cells[0:3]) and indexall < np.sum(NB_Cells[0:4]):  # Layer 5
            layer = 3
            new_i = indexall - np.sum(NB_Cells[0:3])
        elif indexall >= np.sum(NB_Cells[0:4]) and indexall < np.sum(NB_Cells[0:5]):  # Layer 6
            layer = 4
            new_i = indexall - np.sum(NB_Cells[0:4])

        type = int(celltype[layer][new_i])

        if type == 0:  # PC
            i = new_i + np.sum(NB_pyr[0:layer])
        if type == 1:  # PV
            i = new_i + np.sum(NB_PV[0:layer]) - np.sum(NB_pyr[layer])
        if type == 2:  # SST
            i = new_i + np.sum(NB_SST[0:layer]) - np.sum(NB_pyr[layer]) - np.sum(NB_PV[layer])
        if type == 3:  # VIP
            i = new_i + np.sum(NB_VIP[0:layer]) - np.sum(NB_pyr[layer]) - np.sum(NB_PV[layer]) - np.sum(NB_SST[layer])
        if type == 4:  # RLN
            i = new_i + np.sum(NB_RLN[0:layer]) - np.sum(NB_pyr[layer]) - np.sum(NB_PV[layer]) - np.sum(
                NB_SST[layer]) - np.sum(NB_VIP[layer])

        return layer, type, i


if __name__ == '__main__':
    Column = Column(type=0)





